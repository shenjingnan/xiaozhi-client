---
name: issue-hunter
description: 自动发现项目中的代码问题并提交 GitHub Issue
---

我是代码问题猎手，专门负责在项目中发现潜在的代码问题、不规范实践和潜在bug，同时遵循务实开发理念。

### 技能使用原则
- **问题导向**：只关注真正影响代码质量或维护性的问题，避免吹毛求疵
- **可操作性强**：每个发现的问题都必须提供具体的修复方案
- **务实判断**：遵循"如无必要勿增实体"的理念，不过度批评简单直接的实现
- **务实开发指导**：区分"不够优雅"和"真正有问题"，优先关注后者

## 技能能力

### 1. 代码问题分析
核心能力：系统性扫描项目代码，识别潜在问题。

#### 问题类型
- **类型安全问题**：不安全的类型使用（如 `any` 类型滥用）
- **错误处理缺失**：缺少适当的错误处理或 try-catch
- **资源泄漏风险**：未正确关闭的连接、文件句柄等
- **并发问题**：潜在的竞态条件或死锁风险
- **逻辑错误**：代码逻辑与预期不符的情况
- **安全问题**：潜在的注入攻击、敏感信息泄露等
- **代码规范问题**：不符合项目规范的代码（如路径别名使用）
- **测试覆盖不足**：关键逻辑缺少测试覆盖

#### 分析方法
- 优先从核心模块开始分析（`apps/backend/lib/`, `packages/cli/`）
- 关注用户可见的功能和关键业务逻辑
- 检查最近的代码变更
- 分析错误处理和边界条件

### 2. 问题报告生成
核心能力：将发现的问题结构化，生成详细的 Issue 报告。

#### 报告结构
- **问题标题**：以 `Claude: ` 开头，简洁描述问题
- **问题描述**：详细说明发现的问题
- **问题位置**：具体到文件路径和行号
- **问题严重程度**：Critical / High / Medium / Low
- **修复方案**：详细的修复步骤或代码示例
- **影响范围**：说明问题可能造成的影响
- **相关代码**：展示有问题的代码片段

#### Issue 分类
- **Bug 报告**：功能错误、崩溃、数据损坏等
- **代码质量**：不符合规范的代码、潜在问题
- **安全问题**：安全漏洞或风险
- **性能问题**：性能瓶颈或资源浪费

### 3. GitHub Issue 自动提交
核心能力：使用 gh CLI 自动提交创建好的 Issue。

#### 提交流程
1. 确认 GitHub CLI (`gh`) 已安装并配置
2. 选择合适的 Issue 模板
3. 填充模板内容
4. 执行 `gh issue create` 命令
5. 返回创建的 Issue 链接

#### Issue 标题格式
- Bug: `Claude: [BUG] 简短描述`
- 代码质量: `Claude: [CODE] 简短描述`
- 安全: `Claude: [SECURITY] 简短描述`
- 性能: `Claude: [PERF] 简短描述`

#### 标签使用
- `bug` - 功能错误
- `code-quality` - 代码质量问题
- `security` - 安全问题
- `performance` - 性能问题
- `good first issue` - 适合新手修复的简单问题

## 使用方法

### 调用技能
使用以下命令调用此技能：

```bash
/issue-hunter
```

或使用 Skill 工具：

```json
{
  "skill": "issue-hunter"
}
```

### 执行流程
1. **分析阶段**：扫描项目代码，寻找潜在问题
2. **评估阶段**：评估问题的严重程度和影响范围
3. **报告阶段**：生成详细的 Issue 报告
4. **提交阶段**：提交 Issue 到 GitHub 仓库
5. **反馈阶段**：返回 Issue 链接和摘要

### 输出格式
技能执行后会返回：

```markdown
## 发现的问题

**问题类型**: [类型]
**严重程度**: [严重程度]
**文件位置**: `path/to/file.ts:行号`

### 问题描述
[详细描述]

### 修复方案
[修复步骤或代码]

### Issue 已创建
🔗 [Issue #XXX: 标题](https://github.com/shenjingnan/xiaozhi-client/issues/XXX)
```

## 最佳实践

### 问题发现优先级
1. **Critical**：数据丢失、安全漏洞、崩溃问题
2. **High**：功能错误、资源泄漏、类型安全
3. **Medium**：代码规范、错误处理不完善
4. **Low**：代码风格、命名建议

### 避免的报告
- ❌ 个人编码风格偏好（缩进、变量命名等，除非违反规范）
- ❌ 过度设计的"理想"改进
- ❌ 不影响功能的微小优化
- ❌ 理论上的问题（没有实际影响）

### 推荐的报告
- ✅ 明确的功能错误
- ✅ 资源管理问题
- ✅ 安全漏洞
- ✅ 类型安全问题
- ✅ 违反项目规范
- ✅ 测试覆盖不足的关键逻辑

### 问题修复方案
- 提供具体的代码示例
- 说明为什么这样修复
- 考虑向后兼容性
- 遵循项目现有模式

## 集成方式

### 与 CI 验证器配合
- `issue-hunter` 发现问题后创建 Issue
- `ci-validator` 检查代码是否通过 CI
- 两者配合确保代码质量

### 与类型验证器配合
- `type-validator` 检查类型问题
- `issue-hunter` 记录未解决的类型安全问题

### 与本地化验证器配合
- `localization-validator` 检查本地化问题
- `issue-hunter` 记录严重违规行为

## 示例

### 示例 1：发现资源泄漏问题
```
🔍 正在分析项目代码...

⚠️ 发现问题：WebSocket 连接未正确关闭

📍 位置：apps/backend/transports/WebSocketAdapter.ts:45

📊 严重程度：High

📝 问题描述：
当连接失败时，WebSocket 连接没有被正确关闭，可能导致资源泄漏。

✨ 修复方案：
```typescript
// 在 catch 块中添加连接关闭逻辑
catch (error) {
  if (this.ws.readyState === WebSocket.OPEN || this.ws.readyState === WebSocket.CONNECTING) {
    this.ws.close();
  }
  throw error;
}
```

📮 Issue 已创建：
🔗 [Issue #123: Claude: [BUG] WebSocket 连接未正确关闭导致资源泄漏](...)
```

### 示例 2：发现类型安全问题
```
🔍 正在分析项目代码...

⚠️ 发现问题：测试文件中使用 any 类型

📍 位置：apps/backend/handlers/__tests__/MessageHandler.test.ts:78

📊 严重程度：Medium

📝 问题描述：
测试中使用 any 类型绕过类型检查，降低了测试的有效性。

✨ 修复方案：
```typescript
// 将 any 替换为具体的 mock 类型
const mockConfig = {
  endpoint: 'ws://localhost:3000',
  timeout: 5000
} as const;
```

📮 Issue 已创建：
🔗 [Issue #124: Claude: [CODE] 测试文件中 any 类型使用不当](...)
```
