---
description: 获取GitHub PR的Copilot评论并分析修复问题
argument-hint: [pr-number]
---

# GitHub PR Copilot 评论分析和修复

## 目标

获取指定 GitHub PR 中的 Copilot 评论，分析其指出的问题，并制定修复计划。

## 参数

- PR 编号: `$1`（必需）

## 执行步骤

### 0. 环境预检查

在开始分析之前，先检查环境状态：

**检查 Git 状态**:
!`git status --porcelain`

**检查当前分支**:
!`git branch --show-current`

**确保有最新的 PR 信息**:
!`git fetch origin`

### 1. 获取 PR 信息和 Copilot 评论

首先获取 PR 的基本信息和 Copilot 评论

### 2. 分析 Copilot 评论

仔细阅读并分析 Copilot 的评论内容，重点关注：

#### 问题类型分析

- **代码质量问题**: linting 错误、代码规范问题
- **类型安全问题**: TypeScript 类型错误、类型定义问题
- **性能问题**: 性能瓶颈、优化建议
- **安全性问题**: 安全漏洞、潜在风险
- **可维护性问题**: 代码重复、复杂度过高
- **测试问题**: 测试覆盖率、测试质量

#### 严重程度评估

- **Critical**: 阻塞性问题，必须修复
- **High**: 重要问题，建议立即修复
- **Medium**: 中等问题，可以稍后修复
- **Low**: 轻微问题，可选修复

### 3. 代码审查和问题验证

根据 Copilot 提到的问题，进行代码审查：

**获取具体文件变更**:

**分析关键文件**:
使用 `@文件路径` 引用具体文件进行深入分析

### 4. 制定修复计划

基于分析结果，使用 ExitPlanMode 工具制定详细的修复计划：

#### 计划内容应包括：

1. **问题总结**: 清晰列出所有发现的问题
2. **修复优先级**: 按严重程度排序
3. **具体修复步骤**: 每个问题的详细修复方案
4. **测试策略**: 如何验证修复效果
5. **风险评估**: 修复可能带来的风险

### 5. 执行修复

按照计划逐步执行修复：

#### 使用 TodoWrite 工具跟踪进度

- 创建详细的任务列表
- 跟踪每个修复步骤的状态
- 确保所有问题都得到处理

#### 修复执行原则

- **最小化变更**: 只修改必要的代码
- **保持一致性**: 遵循项目现有的代码风格
- **测试验证**: 每个修复都要经过测试验证
- **文档更新**: 如需要，更新相关文档

### 6. 质量验证

修复完成后的验证步骤：

**代码质量检查**:
!`pnpm check:fix`

**类型检查**:
!`pnpm type:check`

**构建验证**:
!`pnpm build`

**测试验证**:
!`pnpm test`

## 使用示例

```bash
# 分析PR #398的Copilot评论
/fix-github-comment 398

# 分析PR #123的Copilot评论
/fix-github-comment 123
```

## 注意事项

1. **权限要求**: 确保有访问 GitHub PR 的权限
2. **环境准备**: 确保已安装 gh CLI 并登录
3. **分支状态**: 确保本地分支代码是最新的
4. **备份重要**: 在修复前确保重要代码已备份

## 预期输出

该命令将提供：

- PR 状态和基本信息
- Copilot 评论的完整内容
- 问题分析和严重程度评估
- 详细的修复计划
- 修复执行进度跟踪
- 质量验证结果

### 7. 生成修复总结

修复完成后，生成详细的总结报告：

**创建修复报告**:

```markdown
# PR #$1 修复报告

## 修复概览

- 修复的问题数量: X 个
- 修复的文件数量: X 个
- 修复耗时: X 分钟

## 问题分类

- 代码质量: X 个
- 类型安全: X 个
- 性能优化: X 个
- 安全问题: X 个

## 质量指标

- 代码检查: ✅ 通过
- 类型检查: ✅ 通过
- 构建状态: ✅ 通过
- 测试状态: ✅ 通过
```

## 高级功能

### 批量处理多个 PR

```bash
# 批量分析多个PR
for pr in 123 124 125; do
  echo "=== 分析 PR #$pr ==="
  /fix-github-comment $pr
done
```

### 集成 CI/CD

可以将此命令集成到 CI/CD 流程中：

```yaml
# .github/workflows/pr-review.yml
name: PR Review Bot
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
      - name: Install dependencies
        run: pnpm install
      - name: Analyze PR with Claude
        run: claude /fix-github-comment ${{ github.event.number }}
```

## 最佳实践建议

### 分析阶段

1. **仔细阅读评论**: 不要遗漏 Copilot 提到的任何细节
2. **理解问题本质**: 不要只修复表面问题，要理解根本原因
3. **评估影响范围**: 考虑修复可能带来的副作用

### 修复阶段

1. **小步快跑**: 一次只修复一个问题，避免大范围的变更
2. **保持风格一致**: 遵循项目现有的代码风格和约定
3. **添加必要注释**: 对复杂的修复逻辑添加注释说明

### 验证阶段

1. **全面测试**: 不仅运行相关测试，还要运行完整测试套件
2. **手动验证**: 对于 UI 相关的修复，进行手动验证
3. **性能检查**: 确保修复没有引入性能问题

## 常见问题处理

### Q: 如果 Copilot 评论不清晰怎么办？

A: 仔细查看评论提到的具体文件和代码行，结合上下文理解问题。

### Q: 如果不同意 Copilot 的建议怎么办？

A: 评估建议的合理性，如果确实不需要修复，可以添加注释说明原因。

### Q: 如果修复导致其他测试失败怎么办？

A: 使用 TodoWrite 工具跟踪所有相关问题，逐步解决所有依赖问题。

### Q: 如何处理循环依赖的修复问题？

A: 先修复最基础的问题，然后逐步解决依赖问题。

请提供要分析的 PR 编号，我将开始执行这个完整的问题分析和修复流程。
