---
description: 修复指定文件中的 any 类型问题
argument-hint: [文件路径]
---

# 修复文件中的 any 类型问题

我将帮你修复文件 `<path>$1</path>` 中的 `any` 类型使用问题，遵循项目的零容忍 `any` 类型政策。

## 分析阶段

### 1. 识别 any 类型使用

- 搜索文件中所有 `any` 类型的使用位置
- 分析每个 `any` 类型的使用上下文和目的
- 识别可以从标准库或已有类型中导入的具体类型

### 2. 分类处理策略

- **可替换的具体类型**：使用明确的 TypeScript 类型或接口
- **未知数据类型**：使用 `unknown` 替代 `any`
- **参数对象**：使用 `Record<string, unknown>` 或更具体的键值类型
- **第三方库类型**：检查并安装相应的 `@types/*` 包
- **MCP 协议类型**：从 `@modelcontextprotocol/sdk/types.js` 导入标准类型

## 修复阶段

### 3. 类型导入和定义

- 从项目依赖中导入可用的标准类型
- 创建或扩展本地接口定义
- 使用项目路径别名正确导入类型

### 4. 类型安全替换

- 将 `any` 替换为具体的类型或接口
- 添加必要的类型守卫函数
- 保持向后兼容性，不破坏现有功能

### 5. 代码规范遵循

- 确保所有导入语句符合项目规范（Node.js 内置 → 外部依赖 → 项目别名 → 相对路径）
- 添加中文注释说明复杂类型定义
- 遵循项目的 TypeScript 严格模式要求

## 验证阶段

### 6. 编译和类型检查

- 运行 `pnpm check:type` 确保所有类型错误已修复
- 运行 `pnpm build` 确保代码能够正常编译
- 检查是否有遗留的 `any` 类型使用

### 7. 代码质量检查

- 执行 `pnpm lint` 进行代码规范检查和自动修复
- 验证修复后的代码符合项目质量标准
- 确保测试用例（如有）仍然通过

### 8. 功能测试

- 运行相关测试用例：`pnpm test <相关测试文件>`
- 验证修复后的代码功能正常
- 确保没有引入新的运行时错误

## 特殊处理场景

### 测试文件类型安全

- 使用具体的 React 组件属性类型（如 `React.HTMLAttributes`）
- 避免在测试文件中使用 `any` 类型，优先使用 `unknown` 或具体类型
- 参考项目的测试工具类型定义

### 复杂数据结构

- 对于复杂对象，考虑创建接口定义
- 使用工具类型如 `Partial<T>`、`Required<T>` 等
- 添加运行时类型验证（推荐使用 Zod）

### 第三方集成

- 检查是否需要更新依赖版本以获得更好的类型支持
- 为缺少类型定义的第三方库创建声明文件
- 使用类型断言时要谨慎，优先使用类型守卫

## 交付标准

1. **零 any 类型**：目标文件中不再存在 `any` 类型使用
2. **类型安全**：通过 TypeScript 严格模式检查
3. **代码规范**：符合项目的代码规范和导入顺序
4. **功能完整**：修复后的代码功能与原代码一致
5. **文档完善**：为复杂类型定义添加中文注释

## 预防建议

- 启用 ESLint 规则防止新的 `any` 类型使用
- 定期运行类型检查避免类型退化
- 在代码审查中重点关注类型安全问题
- 为团队提供类型安全最佳实践培训
