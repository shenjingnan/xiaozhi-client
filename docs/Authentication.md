# å°æ™ºAIç®¡ç†åå°è®¤è¯åŠŸèƒ½è¯´æ˜

## æ¦‚è¿°

å°æ™ºAIçš„MCPæœåŠ¡ç®¡ç†ç•Œé¢ç°å·²æ”¯æŒç®¡ç†å‘˜ç™»å½•è®¤è¯æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®åå°ç®¡ç†é¡µé¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” å®‰å…¨è®¤è¯
- JWT (JSON Web Token) è®¤è¯æœºåˆ¶
- æ”¯æŒæ˜æ–‡å¯†ç å’ŒbcryptåŠ å¯†å¯†ç 
- è‡ªåŠ¨tokenåˆ·æ–°æœºåˆ¶
- ä¼šè¯è¶…æ—¶æ§åˆ¶

### âš™ï¸ é…ç½®é©±åŠ¨
- ç®¡ç†å‘˜è´¦å·å¯†ç é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
- å¯å¼€å¯/å…³é—­è®¤è¯åŠŸèƒ½
- æ”¯æŒè‡ªå®šä¹‰JWTå¯†é’¥å’Œä¼šè¯è¶…æ—¶

### ğŸ¨ ç”¨æˆ·å‹å¥½
- ç°ä»£åŒ–ç™»å½•ç•Œé¢
- å“åº”å¼è®¾è®¡æ”¯æŒç§»åŠ¨ç«¯
- æ¸…æ™°çš„é”™è¯¯æç¤º
- ç”¨æˆ·çŠ¶æ€æ˜¾ç¤ºå’Œç™»å‡ºåŠŸèƒ½

## é…ç½®è¯´æ˜

### 1. è®¤è¯é…ç½®ç»“æ„

åœ¨`xiaozhi.config.json`é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è®¤è¯é…ç½®ï¼š

```json
{
  "webUI": {
    "port": 9999,
    "auth": {
      "enabled": true,
      "admin": {
        "username": "admin",
        "password": "admin123"
      },
      "jwtSecret": "your-super-secret-jwt-key-change-this-in-production",
      "sessionTimeout": 86400
    }
  }
}
```

### 2. é…ç½®å‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enabled` | boolean | false | æ˜¯å¦å¯ç”¨è®¤è¯åŠŸèƒ½ |
| `admin.username` | string | "admin" | ç®¡ç†å‘˜ç”¨æˆ·å |
| `admin.password` | string | "admin123" | ç®¡ç†å‘˜å¯†ç ï¼ˆæ”¯æŒæ˜æ–‡å’ŒbcryptåŠ å¯†ï¼‰ |
| `jwtSecret` | string | "default-secret-key" | JWTç­¾åå¯†é’¥ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ |
| `sessionTimeout` | number | 86400 | ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤24å°æ—¶ |

## ä½¿ç”¨æ–¹æ³•

### 1. å¯ç”¨è®¤è¯åŠŸèƒ½

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå°†`auth.enabled`è®¾ç½®ä¸º`true`ï¼š

```json
{
  "webUI": {
    "auth": {
      "enabled": true
    }
  }
}
```

### 2. ä¿®æ”¹ç®¡ç†å‘˜å‡­æ®

```json
{
  "webUI": {
    "auth": {
      "admin": {
        "username": "your_admin_username",
        "password": "your_secure_password"
      }
    }
  }
}
```

### 3. ä½¿ç”¨bcryptåŠ å¯†å¯†ç ï¼ˆæ¨èï¼‰

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå»ºè®®ä½¿ç”¨bcryptåŠ å¯†å¯†ç ï¼š

```bash
# ä½¿ç”¨Node.jsç”Ÿæˆbcryptå¯†ç 
node -e "const bcrypt = require('bcryptjs'); console.log(bcrypt.hashSync('your_password', 10));"
```

ç„¶åå°†ç”Ÿæˆçš„hashå€¼å¡«å…¥é…ç½®æ–‡ä»¶ï¼š

```json
{
  "webUI": {
    "auth": {
      "admin": {
        "username": "admin",
        "password": "$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      }
    }
  }
}
```

### 4. ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®

ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "webUI": {
    "auth": {
      "enabled": true,
      "admin": {
        "username": "your_secure_username",
        "password": "$2a$10$secure_bcrypt_hashed_password"
      },
      "jwtSecret": "your-super-secret-jwt-key-512-bits-long-minimum",
      "sessionTimeout": 28800
    }
  }
}
```

**å®‰å…¨å»ºè®®ï¼š**
- ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘12ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
- JWTå¯†é’¥è‡³å°‘512ä½éšæœºå­—ç¬¦ä¸²
- æ ¹æ®éœ€è¦è°ƒæ•´ä¼šè¯è¶…æ—¶æ—¶é—´

## ç•Œé¢æ“ä½œ

### 1. ç™»å½•ç•Œé¢

å½“å¯ç”¨è®¤è¯åŠŸèƒ½æ—¶ï¼Œè®¿é—®ç®¡ç†ç•Œé¢ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼š

- è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
- ç‚¹å‡»"ç™»å½•"æŒ‰é’®
- ç™»å½•æˆåŠŸåè‡ªåŠ¨è¿›å…¥ç®¡ç†ç•Œé¢

### 2. å·²ç™»å½•çŠ¶æ€

ç™»å½•æˆåŠŸåï¼Œé¡µé¢å³ä¸Šè§’ä¼šæ˜¾ç¤ºï¼š

- ç”¨æˆ·å›¾æ ‡å’Œç”¨æˆ·å
- ç‚¹å‡»å¯æ˜¾ç¤ºä¸‹æ‹‰èœå•
- åŒ…å«"ç™»å‡º"é€‰é¡¹

### 3. è‡ªåŠ¨ç™»å‡º

ä»¥ä¸‹æƒ…å†µä¼šè‡ªåŠ¨ç™»å‡ºï¼š

- ä¼šè¯è¶…æ—¶
- Tokenå¤±æ•ˆ
- æœåŠ¡å™¨è¿”å›è®¤è¯é”™è¯¯

## APIæ¥å£

ç³»ç»Ÿæä¾›ä»¥ä¸‹è®¤è¯ç›¸å…³çš„APIæ¥å£ï¼š

### 1. ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

### 2. ç™»å‡º
```http
POST /api/auth/logout
Authorization: Bearer <token>
```

### 3. éªŒè¯Token
```http
GET /api/auth/verify
Authorization: Bearer <token>
```

### 4. åˆ·æ–°Token
```http
POST /api/auth/refresh
Authorization: Bearer <token>
```

### 5. è·å–è®¤è¯çŠ¶æ€
```http
GET /api/auth/status
```

## æ•…éšœæ’é™¤

### 1. æ— æ³•ç™»å½•

**é—®é¢˜ï¼š** è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ä»æ— æ³•ç™»å½•

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„è®¤è¯é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å¯†ç æ ¼å¼ï¼ˆæ˜æ–‡æˆ–bcryptï¼‰
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 2. é¢‘ç¹ç™»å‡º

**é—®é¢˜ï¼š** ç™»å½•åå¾ˆå¿«å°±è¢«è‡ªåŠ¨ç™»å‡º

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥`sessionTimeout`é…ç½®
- ç¡®è®¤ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥JWTå¯†é’¥æ˜¯å¦ç¨³å®š

### 3. è®¤è¯åŠŸèƒ½æ— æ•ˆ

**é—®é¢˜ï¼š** è®¾ç½®`enabled: true`åä»å¯ç›´æ¥è®¿é—®

**è§£å†³æ–¹æ¡ˆï¼š**
- é‡å¯WebæœåŠ¡å™¨
- æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
- ç¡®è®¤é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®

### 4. é…ç½®æ›´æ–°ä¸ç”Ÿæ•ˆ

**é—®é¢˜ï¼š** ä¿®æ”¹é…ç½®åè®¤è¯çŠ¶æ€æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**
- é‡å¯å°æ™ºå®¢æˆ·ç«¯æœåŠ¡
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥é…ç½®æ–‡ä»¶ä¿å­˜æ˜¯å¦æˆåŠŸ

## å¼€å‘é›†æˆ

### å‰ç«¯é›†æˆ

å‰ç«¯è¯·æ±‚éœ€è¦åŒ…å«è®¤è¯å¤´ï¼š

```typescript
// ä½¿ç”¨AuthService
import { AuthService } from './services/AuthService';

// è‡ªåŠ¨æ·»åŠ è®¤è¯å¤´çš„è¯·æ±‚
const response = await AuthService.authenticatedFetch('/api/config');

// æ‰‹åŠ¨æ·»åŠ è®¤è¯å¤´
const headers = AuthService.getAuthHeaders();
const response = await fetch('/api/status', { headers });
```

### ä¸­é—´ä»¶ä¿æŠ¤

åç«¯APIè·¯ç”±ä½¿ç”¨è®¤è¯ä¸­é—´ä»¶ä¿æŠ¤ï¼š

```typescript
// éœ€è¦è®¤è¯çš„è·¯ç”±
app.get("/api/config", authMiddleware, handler);

// å¯é€‰è®¤è¯çš„è·¯ç”±
app.get("/api/public", optionalAuthMiddleware, handler);

// å…¬å¼€è·¯ç”±ï¼ˆæ— éœ€è®¤è¯ï¼‰
app.get("/api/auth/status", handler);
```

## æ›´æ–°æ—¥å¿—

### v1.6.3
- âœ… æ·»åŠ JWTè®¤è¯æœºåˆ¶
- âœ… å®ç°ç™»å½•/ç™»å‡ºåŠŸèƒ½
- âœ… æ”¯æŒbcryptå¯†ç åŠ å¯†
- âœ… è‡ªåŠ¨tokenåˆ·æ–°
- âœ… ç°ä»£åŒ–ç™»å½•ç•Œé¢
- âœ… é…ç½®é©±åŠ¨çš„è®¤è¯æ§åˆ¶

## è®¸å¯è¯

æœ¬åŠŸèƒ½éµå¾ªé¡¹ç›®çš„å¼€æºè®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚
